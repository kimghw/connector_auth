<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MCP 웹에디터 데이터 흐름 및 핸들러 처리 가이드</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <style>
        :root {
            --primary-color: #0071e3;
            --bg-color: #f5f5f7;
            --card-bg: #ffffff;
            --text-primary: #1d1d1f;
            --text-secondary: #86868b;
            --border-color: #d2d2d7;
            --code-bg: #1e1e1e;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background: var(--bg-color);
            color: var(--text-primary);
            line-height: 1.6;
        }
        .header {
            background: rgba(255,255,255,0.9);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--border-color);
            padding: 15px 30px;
            position: sticky;
            top: 0;
            z-index: 100;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .header h1 {
            font-size: 20px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .header h1 .material-icons { color: var(--primary-color); }
        .back-btn {
            display: flex;
            align-items: center;
            gap: 5px;
            padding: 8px 16px;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            text-decoration: none;
        }
        .back-btn:hover { background: #0077ed; }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 30px;
        }
        .nav-toc {
            position: fixed;
            right: 20px;
            top: 80px;
            width: 200px;
            background: var(--card-bg);
            border-radius: 12px;
            padding: 15px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            font-size: 13px;
        }
        .nav-toc h3 {
            font-size: 14px;
            margin-bottom: 10px;
            color: var(--text-secondary);
        }
        .nav-toc a {
            display: block;
            color: var(--text-primary);
            text-decoration: none;
            padding: 5px 0;
            border-left: 2px solid transparent;
            padding-left: 10px;
        }
        .nav-toc a:hover, .nav-toc a.active {
            color: var(--primary-color);
            border-left-color: var(--primary-color);
        }
        .content { margin-right: 240px; }
        .section {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        h2 {
            font-size: 22px;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--primary-color);
            color: var(--text-primary);
        }
        h3 {
            font-size: 18px;
            margin: 20px 0 15px 0;
            color: var(--text-primary);
        }
        h4 {
            font-size: 16px;
            margin: 15px 0 10px 0;
            color: var(--primary-color);
        }
        .mermaid {
            background: #fafafa;
            border-radius: 8px;
            padding: 20px;
            margin: 15px 0;
            overflow-x: auto;
        }
        pre.ascii-diagram {
            background: var(--code-bg);
            color: #d4d4d4;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 12px;
            line-height: 1.4;
            margin: 15px 0;
        }
        pre.code-block {
            background: var(--code-bg);
            color: #d4d4d4;
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
            font-family: 'Consolas', monospace;
            font-size: 13px;
            margin: 10px 0;
        }
        .code-block .keyword { color: #569cd6; }
        .code-block .string { color: #ce9178; }
        .code-block .comment { color: #6a9955; }
        .code-block .function { color: #dcdcaa; }
        code {
            background: rgba(0,0,0,0.06);
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Consolas', monospace;
            font-size: 13px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            font-size: 14px;
        }
        th, td {
            border: 1px solid var(--border-color);
            padding: 12px;
            text-align: left;
        }
        th {
            background: #f0f0f2;
            font-weight: 600;
        }
        tr:hover { background: #fafafa; }
        .highlight-box {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin: 15px 0;
            border-radius: 0 8px 8px 0;
        }
        .info-box {
            background: #e7f3ff;
            border-left: 4px solid var(--primary-color);
            padding: 15px;
            margin: 15px 0;
            border-radius: 0 8px 8px 0;
        }
        ul, ol { margin: 10px 0 10px 25px; }
        li { margin: 5px 0; }
        .phase-badge {
            display: inline-block;
            background: var(--primary-color);
            color: white;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: 600;
            margin-right: 8px;
        }
        @media (max-width: 1024px) {
            .nav-toc { display: none; }
            .content { margin-right: 0; }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>
            <span class="material-icons">schema</span>
            MCP 웹에디터 데이터 흐름 및 핸들러 처리 가이드
        </h1>
        <a href="/" class="back-btn">
            <span class="material-icons">arrow_back</span>
            에디터로 돌아가기
        </a>
    </div>

    <nav class="nav-toc">
        <h3>목차</h3>
        <a href="#section1">1. 전체 시스템 아키텍처</a>
        <a href="#section2">2. Phase별 데이터 흐름</a>
        <a href="#section3">3. 파라미터 매핑 구조</a>
        <a href="#section4">4. 핸들러 처리 흐름</a>
        <a href="#section5">5. 파라미터 병합 체계</a>
        <a href="#section6">6. 핵심 저장 위치 요약</a>
        <a href="#section7">7. 전체 데이터 변환 흐름</a>
        <a href="#section8">8. 호출 함수/메서드 명세</a>
        <a href="#section9">9. 파일 경로 참조</a>
    </nav>

    <div class="container">
        <div class="content">
            <!-- Section 1: 전체 시스템 아키텍처 -->
            <div class="section" id="section1">
                <h2>1. 전체 시스템 아키텍처</h2>
                <div class="mermaid">
flowchart TB
    subgraph Sources["데이터 소스 (Source Files)"]
        S1["@mcp_service<br/>데코레이터"]
        S2["tool_definition_<br/>templates.py"]
        S3["tool_internal_<br/>args.json"]
    end

    subgraph Editor["웹에디터 (tool_editor_web.py)"]
        E1["AST Scanner"]
        E2["JSON Registry"]
        E3["Internal Args Loader"]
        UI["웹 UI"]
    end

    subgraph Save["저장 & 생성"]
        API1["POST /api/tools/save-all"]
        API2["POST /api/server/generate"]
    end

    subgraph Generate["서버 생성 (Jinja2)"]
        IN["Input Files"]
        OUT["Output Files<br/>• server_rest.py<br/>• server_stdio.py<br/>• server_stream.py"]
    end

    subgraph Runtime["런타임 실행"]
        RT["LLM 호출 → 파라미터 추출 → 병합 → 서비스 실행 → 결과 반환"]
    end

    S1 --> E1 --> UI
    S2 --> E2 --> UI
    S3 --> E3 --> UI
    UI --> API1 & API2
    API1 & API2 --> IN --> OUT --> RT
                </div>
            </div>

            <!-- Section 2: Phase별 데이터 흐름 -->
            <div class="section" id="section2">
                <h2>2. Phase별 데이터 흐름 (빌드 타임)</h2>

                <h3><span class="phase-badge">Phase 1</span> 데이터 수집 (웹에디터 시작)</h3>
                <div class="mermaid">
flowchart TD
    PY["Python 파일<br/>(@mcp_service)"] --> AST["AST Scanner"]
    AST --> REG["registry_{server}.json"]
    REG --> SVC["services dict (메모리)"]

    TPL["tool_definition_templates.py"] --> IMP["importlib"]
    IMP --> TOOLS["MCP_TOOLS 리스트 (메모리)"]

    JSON["tool_internal_args.json"] --> LOAD["JSON.load()"]
    LOAD --> ARGS["internal_args dict (메모리)"]
                </div>

                <h3><span class="phase-badge">Phase 2</span> 웹 UI 편집</h3>
                <div class="info-box">
                    웹에디터 UI에서 Tool 목록을 표시하고, 속성 추가/삭제/수정 및 Internal toggle 설정을 수행합니다.
                </div>

                <h3><span class="phase-badge">Phase 3</span> Save 시 데이터 분리</h3>
                <div class="mermaid">
flowchart TD
    SAVE["웹에디터 Save 버튼"]
    SAVE --> DEF["tool_definitions.py<br/>(Claude/OpenAI API용)"]
    SAVE --> TPL["tool_definition_templates.py<br/>(서버 생성 템플릿용)"]
    SAVE --> INT["tool_internal_args.json<br/>(런타임 주입용)"]
                </div>

                <h3><span class="phase-badge">Phase 4</span> Generate Server</h3>
                <div class="mermaid">
flowchart LR
    GEN["generate_universal_server.py<br/>prepare_context()"]
    GEN --> REST["server_rest.py"]
    GEN --> STDIO["server_stdio.py"]
    GEN --> STREAM["server_stream.py"]
                </div>
            </div>

            <!-- Section 3: 파라미터 매핑 구조 -->
            <div class="section" id="section3">
                <h2>3. 파라미터 매핑 구조</h2>

                <h3>targetParam 매핑 흐름</h3>
                <div class="mermaid">
flowchart LR
    A["'DatePeriodFilter'<br/>(LLM이 보는 이름)"] -->|targetParam| B["'filter_params'<br/>(실제 메서드 파라미터)"]
                </div>

                <pre class="code-block"><span class="comment"># tool_definition_templates.py</span>
<span class="string">'inputSchema'</span>: {
    <span class="string">'properties'</span>: {
        <span class="string">'DatePeriodFilter'</span>: {           <span class="comment">← LLM이 보는 이름</span>
            <span class="string">'targetParam'</span>: <span class="string">'filter_params'</span>,  <span class="comment">← 실제 파라미터명</span>
            <span class="string">'baseModel'</span>: <span class="string">'FilterParams'</span>,
        }
    }
}</pre>

                <h3>Internal Args 매핑 흐름</h3>
                <div class="mermaid">
flowchart LR
    C["'select'<br/>(Internal arg 이름)"] -->|targetParam| D["'select_params'<br/>(메서드 파라미터)"]
                </div>

                <pre class="code-block"><span class="comment">// tool_internal_args.json</span>
{
    <span class="string">"mail_list_period"</span>: {
        <span class="string">"select"</span>: {                       <span class="comment">← Internal arg 이름</span>
            <span class="string">"targetParam"</span>: <span class="string">"select_params"</span>,  <span class="comment">← 메서드에 전달될 이름</span>
            <span class="string">"type"</span>: <span class="string">"SelectParams"</span>,
            <span class="string">"original_schema"</span>: { ... }
        }
    }
}</pre>
            </div>

            <!-- Section 4: 핸들러 처리 흐름 -->
            <div class="section" id="section4">
                <h2>4. 핸들러 처리 흐름 (런타임)</h2>

                <h3>전체 처리 흐름도</h3>
                <div class="mermaid">
flowchart TD
    A["LLM 입력(args)"] --> B["1. 파라미터 추출<br/>필수/선택 파라미터 분리"]
    B --> C["2. 딕셔너리 → 객체 변환<br/>Pydantic 변환 + 첫 번째 병합"]
    C --> D["3. call_args 구성<br/>Signature 파라미터 설정"]
    D --> E["4. Internal 구성<br/>시스템 고정값 로드"]
    E --> F["5. 파라미터 병합<br/>두 번째 병합 (Signature > Internal)"]
    F --> G["6. 서비스 함수 호출<br/>비즈니스 로직 실행"]
    G --> H["결과 반환"]
                </div>

                <h4>1단계: 파라미터 추출</h4>
                <pre class="code-block"><span class="comment"># 필수 파라미터 - 직접 접근</span>
user_email = args[<span class="string">"user_email"</span>]

<span class="comment"># 선택 파라미터 - .get() 사용</span>
query_method_raw = args.<span class="function">get</span>(<span class="string">"query_method"</span>)

<span class="comment"># 기본값 처리</span>
query_method = query_method_raw <span class="keyword">if</span> query_method_raw <span class="keyword">is not None else</span> QueryMethod.FILTER</pre>

                <h4>2단계: 파라미터 객체 변환 - 첫 번째 병합</h4>
                <pre class="code-block"><span class="comment"># 첫 번째 병합: 파라미터 내부의 Internal과 사용자 입력 병합</span>
DatePeriodFilter_data = <span class="function">merge_param_data</span>(
    DatePeriodFilter_internal_data,  <span class="comment"># base: Internal 데이터</span>
    DatePeriodFilter                 <span class="comment"># overlay: 사용자 입력</span>
)

<span class="comment"># Pydantic 객체로 변환</span>
DatePeriodFilter_params = <span class="function">FilterParams</span>(**DatePeriodFilter_data)</pre>

                <h4>5단계: 파라미터 병합 - 두 번째 병합</h4>
                <pre class="code-block"><span class="keyword">if</span> <span class="string">"select_params"</span> <span class="keyword">in</span> call_args:
    <span class="comment"># 객체의 속성 단위로 병합</span>
    internal_dict = {k: v <span class="keyword">for</span> k, v <span class="keyword">in</span> <span class="function">vars</span>(_internal_select).<span class="function">items</span>() <span class="keyword">if</span> v <span class="keyword">is not None</span>}
    existing_dict = {k: v <span class="keyword">for</span> k, v <span class="keyword">in</span> <span class="function">vars</span>(existing_value).<span class="function">items</span>() <span class="keyword">if</span> v <span class="keyword">is not None</span>}

    <span class="comment"># Internal을 base로, Signature로 덮어씀</span>
    merged_dict = {**internal_dict, **existing_dict}
<span class="keyword">else</span>:
    call_args[<span class="string">"select_params"</span>] = _internal_select</pre>
            </div>

            <!-- Section 5: 파라미터 병합 체계 -->
            <div class="section" id="section5">
                <h2>5. 파라미터 병합 체계</h2>

                <h3>파라미터 3단계 구조</h3>
                <ol>
                    <li><strong>Signature 파라미터</strong> (사용자 입력) - LLM이 직접 제공, 최고 우선순위</li>
                    <li><strong>Signature 내부 Internal</strong> (파라미터별) - 2단계에서 병합</li>
                    <li><strong>도구 레벨 Internal</strong> (전역) - 5단계에서 병합</li>
                </ol>

                <h3>두 번의 병합 과정</h3>
                <div class="mermaid">
flowchart LR
    subgraph First["첫 번째 병합 (2단계)"]
        A1["Signature 내부 Internal"] --> M1["병합"]
        A2["사용자 입력"] --> M1
        M1 --> R1["Signature 파라미터 객체"]
    end

    subgraph Second["두 번째 병합 (5단계)"]
        B1["도구 레벨 Internal"] --> M2["병합"]
        R1 --> M2
        M2 --> R2["최종 파라미터"]
    end
                </div>

                <h3>최종 우선순위</h3>
                <div class="highlight-box">
                    <strong>사용자 입력 > Signature 내부 Internal > 도구 레벨 Internal > 기본값</strong>
                </div>

                <h3>주요 원칙</h3>
                <ul>
                    <li><strong>None 값 처리:</strong> 병합 시 None 값은 제외 → 부분 업데이트 가능</li>
                    <li><strong>타입 안전성:</strong> Pydantic을 통한 타입 검증 및 런타임 체크</li>
                </ul>
            </div>

            <!-- Section 6: 핵심 저장 위치 요약 -->
            <div class="section" id="section6">
                <h2>6. 핵심 저장 위치 요약</h2>
                <table>
                    <thead>
                        <tr>
                            <th>데이터</th>
                            <th>소스</th>
                            <th>저장 위치</th>
                            <th>용도</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>클래스/메서드 정보</td>
                            <td><code>@mcp_service</code> 데코레이터</td>
                            <td><code>registry_{server}.json</code></td>
                            <td>서비스 라우팅</td>
                        </tr>
                        <tr>
                            <td>파라미터 타입/기본값</td>
                            <td>함수 시그니처</td>
                            <td><code>registry_{server}.json</code></td>
                            <td>타입 검증</td>
                        </tr>
                        <tr>
                            <td>LLM용 스키마</td>
                            <td>웹에디터 편집</td>
                            <td><code>tool_definition_templates.py</code></td>
                            <td>Claude API</td>
                        </tr>
                        <tr>
                            <td>targetParam 매핑</td>
                            <td>웹에디터 설정</td>
                            <td><code>tool_definition_templates.py</code></td>
                            <td>파라미터 변환</td>
                        </tr>
                        <tr>
                            <td>Internal 파라미터</td>
                            <td>웹에디터 토글</td>
                            <td><code>tool_internal_args.json</code></td>
                            <td>런타임 주입</td>
                        </tr>
                        <tr>
                            <td>클린 도구 정의</td>
                            <td>Save 시 생성</td>
                            <td><code>tool_definitions.py</code></td>
                            <td>프로덕션 API</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Section 7: 전체 데이터 변환 흐름 -->
            <div class="section" id="section7">
                <h2>7. 전체 데이터 변환 흐름</h2>
                <div class="mermaid">
flowchart LR
    subgraph Source["소스코드"]
        A1["@mcp_service"]
        A2["outlook_service.py"]
        A3["outlook_types.py"]
        A4["(웹에서 편집)"]
    end

    subgraph Editor["웹에디터"]
        B1["registry.json"]
        B2["mcp_service.parameters"]
        B3["inputSchema.baseModel"]
        B4["tool_internal_args.json"]
    end

    subgraph Server["생성된 서버"]
        C1["import 경로"]
        C2["핸들러 서명"]
        C3["Pydantic 변환"]
        C4["build_internal_param()"]
    end

    A1 --> B1 --> C1
    A2 --> B2 --> C2
    A3 --> B3 --> C3
    A4 --> B4 --> C4
                </div>
            </div>

            <!-- Section 8: 호출 함수/메서드 명세 -->
            <div class="section" id="section8">
                <h2>8. 호출 함수/메서드 명세</h2>

                <h3>빌드 타임 호출 체인</h3>
                <div class="mermaid">
flowchart TD
    subgraph Scan["1. 레지스트리 스캔 (웹에디터 시작)"]
        A1["mcp_service_scanner.py"] --> A2["scan_codebase_for_mcp_services()"]
        A2 --> A3["AST NodeVisitor"]
        A3 --> A4["registry_{server}.json"]
    end

    subgraph Gen["2. 서버 생성 (Generate Server 클릭)"]
        B1["tool_editor_web.py"] --> B2["generate_server_from_web()"]
        B2 --> B3["generate_universal_server.py"]
        B3 --> B4["prepare_context()"]
        B4 --> B5["generate_server()"]
        B5 --> B6["server_{protocol}.py"]
    end

    A4 --> B4
                </div>

                <h3>런타임 호출 체인</h3>
                <div class="mermaid">
flowchart TD
    LLM["LLM 요청 수신"] --> H["handle_{tool_name}(args)"]
    H --> E["파라미터 추출<br/>args['param'] / args.get('param')"]
    E --> BI["build_internal_param()<br/>INTERNAL_ARGS 조회"]
    BI --> MP["merge_param_data()<br/>internal + runtime 병합"]
    MP --> SVC["service.method(**call_args)<br/>비즈니스 로직 호출"]
    SVC --> RET["결과 반환"]
                </div>

                <h3>핵심 함수 상세</h3>
                <table>
                    <thead>
                        <tr>
                            <th>함수명</th>
                            <th>정의 위치</th>
                            <th>호출 시점</th>
                            <th>역할</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>scan_codebase_for_mcp_services()</code></td>
                            <td><code>mcp_service_scanner.py:252</code></td>
                            <td>웹에디터 시작/Reload</td>
                            <td>@mcp_service 스캔 → registry.json</td>
                        </tr>
                        <tr>
                            <td><code>prepare_context()</code></td>
                            <td><code>generate_universal_server.py:220</code></td>
                            <td>Generate Server</td>
                            <td>템플릿 렌더링용 context 생성</td>
                        </tr>
                        <tr>
                            <td><code>generate_server()</code></td>
                            <td><code>generate_universal_server.py:446</code></td>
                            <td>Generate Server</td>
                            <td>Jinja2로 서버 코드 생성</td>
                        </tr>
                        <tr>
                            <td><code>build_internal_param()</code></td>
                            <td><code>universal_server_template.jinja2:213</code></td>
                            <td>런타임 핸들러</td>
                            <td>Internal 파라미터 빌드</td>
                        </tr>
                        <tr>
                            <td><code>merge_param_data()</code></td>
                            <td><code>universal_server_template.jinja2:262</code></td>
                            <td>런타임 핸들러</td>
                            <td>파라미터 병합</td>
                        </tr>
                        <tr>
                            <td><code>handle_{tool_name}()</code></td>
                            <td>생성된 <code>server_{protocol}.py</code></td>
                            <td>LLM 요청 수신</td>
                            <td>MCP Tool 핸들러</td>
                        </tr>
                    </tbody>
                </table>

                <h3>호출 흐름 요약</h3>
                <div class="mermaid">
flowchart LR
    subgraph Build["빌드 타임"]
        D1["@mcp_service"] --> D2["scan_codebase_for_mcp_services()"]
        D2 --> D3["registry.json"]
        D4["웹에디터 편집"] --> D5["templates.py + internal_args.json"]
        D5 --> D6["prepare_context()"]
        D6 --> D7["generate_server()"]
        D7 --> D8["server_{protocol}.py"]
    end

    subgraph Runtime["런타임"]
        R1["LLM 요청"] --> R2["handle_{tool_name}()"]
        R2 --> R3["build_internal_param()"]
        R3 --> R4["merge_param_data()"]
        R4 --> R5["service.method()"]
        R5 --> R6["결과 반환"]
    end

    D8 --> R2
                </div>
            </div>

            <!-- Section 9: 파일 경로 참조 -->
            <div class="section" id="section9">
                <h2>9. 파일 경로 참조</h2>
                <table>
                    <thead>
                        <tr>
                            <th>구분</th>
                            <th>경로</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr><td>웹에디터</td><td><code>mcp_editor/tool_editor_web.py</code></td></tr>
                        <tr><td>레지스트리 스캐너</td><td><code>mcp_editor/mcp_service_registry/mcp_service_scanner.py</code></td></tr>
                        <tr><td>레지스트리</td><td><code>mcp_editor/mcp_service_registry/registry_{server}.json</code></td></tr>
                        <tr><td>템플릿 정의</td><td><code>mcp_editor/mcp_{server}/tool_definition_templates.py</code></td></tr>
                        <tr><td>Internal Args</td><td><code>mcp_editor/mcp_{server}/tool_internal_args.json</code></td></tr>
                        <tr><td>서버 생성</td><td><code>jinja/generate_universal_server.py</code></td></tr>
                        <tr><td>Jinja2 템플릿</td><td><code>jinja/universal_server_template.jinja2</code></td></tr>
                        <tr><td>생성된 서버</td><td><code>mcp_{service}/mcp_server/server_{protocol}.py</code></td></tr>
                        <tr><td>도구 정의</td><td><code>mcp_{service}/mcp_server/tool_definitions.py</code></td></tr>
                    </tbody>
                </table>
            </div>

        </div>
    </div>

    <script>
        mermaid.initialize({
            startOnLoad: true,
            theme: 'default',
            flowchart: { useMaxWidth: true, htmlLabels: true, curve: 'basis' }
        });

        // TOC 스크롤 추적
        const sections = document.querySelectorAll('.section');
        const navLinks = document.querySelectorAll('.nav-toc a');

        window.addEventListener('scroll', () => {
            let current = '';
            sections.forEach(section => {
                const sectionTop = section.offsetTop;
                if (scrollY >= sectionTop - 100) {
                    current = section.getAttribute('id');
                }
            });
            navLinks.forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('href') === '#' + current) {
                    link.classList.add('active');
                }
            });
        });
    </script>
</body>
</html>
