# MCP Handler Chain Builder - 작업 계획

## 1. 프로젝트 개요
- **목표**: MCP 서비스 함수들을 체인 형식으로 연결하는 웹 기반 빌더 시스템 구축
- **작업 위치**: `/home/kimghw/Connector_auth/mcp_builder/`
- **예상 기간**: 3-4주

## 2. 단계별 작업 계획

### Phase 1: 기초 설정 및 백엔드 구조 (Week 1)

#### 1.1 프로젝트 초기화 (Day 1)
- [ ] `mcp_builder` 디렉토리 구조 생성
- [ ] 필요한 패키지 설치 (requirements.txt 작성)
- [ ] 기본 Flask/FastAPI 서버 설정
- [ ] CORS 및 기본 라우팅 구성

#### 1.2 서비스 스캐너 통합 (Day 2)
- [ ] 기존 `mcp_service_scanner.py` 임포트 및 연동
- [ ] 서비스 함수 메타데이터 수집 API 구현
  - GET `/api/services` - 사용 가능한 서비스 목록
  - GET `/api/services/{service_name}` - 서비스 상세 정보
- [ ] AST 기반 파라미터 분석 모듈 통합

#### 1.3 체인 데이터 모델 구현 (Day 3)
- [ ] Chain 데이터 모델 정의 (Pydantic/SQLAlchemy)
- [ ] 매핑 규칙 데이터 구조 설계
- [ ] 체인 설정 저장/불러오기 API
  - POST `/api/chains` - 체인 생성
  - GET `/api/chains/{chain_id}` - 체인 조회
  - PUT `/api/chains/{chain_id}` - 체인 수정

#### 1.4 파라미터 매핑 엔진 (Day 4-5)
- [ ] 매핑 규칙 처리 로직 구현
  - 직접 매핑
  - 배열 매핑
  - 중첩 매핑
  - 다중 매핑
- [ ] 중복 파라미터 감지 및 처리 로직
- [ ] 매핑 우선순위 시스템 구현

### Phase 2: 코드 생성 및 통합 (Week 2)

#### 2.1 코드 생성 엔진 (Day 1-2)
- [ ] AST 기반 코드 생성기 구현
- [ ] 체인 함수 템플릿 작성
- [ ] `@mcp_service` 데코레이터 자동 적용 로직
- [ ] 파라미터 시그니처 생성

#### 2.2 서비스 파일 통합 (Day 3)
- [ ] 기존 `{server_name}_service.py` 파일 파싱
- [ ] AST를 통한 안전한 코드 삽입
- [ ] import 문 자동 추가
- [ ] 백업 메커니즘 구현

#### 2.3 실행 엔진 구현 (Day 4-5)
- [ ] 체인 함수 동적 실행 엔진
- [ ] 중간 인터페이스 실행 중단점
- [ ] 프로덕션 데이터 플로우 관리
- [ ] 에러 핸들링 및 로깅

### Phase 3: 프론트엔드 개발 (Week 3)

#### 3.1 React 프로젝트 설정 (Day 1)
- [ ] Create React App 또는 Vite 설정
- [ ] Redux 스토어 구성
- [ ] React Router 설정
- [ ] 기본 레이아웃 컴포넌트

#### 3.2 플로우 에디터 구현 (Day 2-3)
- [ ] React Flow 통합
- [ ] 노드 컴포넌트 개발
  - 서비스 함수 노드
  - 중간 인터페이스 노드
- [ ] 엣지(연결선) 컴포넌트
- [ ] 드래그 앤 드롭 기능

#### 3.3 파라미터 매핑 UI (Day 4-5)
- [ ] 스플릿 뷰 레이아웃
- [ ] 트리 뷰 컴포넌트 (출력 데이터 표시)
- [ ] 파라미터 리스트 컴포넌트
- [ ] 드래그 앤 드롭 매핑 기능
- [ ] 매핑 시각화 (연결선)

### Phase 4: 중간 인터페이스 및 고급 기능 (Week 4)

#### 4.1 중간 인터페이스 구현 (Day 1-2)
- [ ] 실행 중단점 UI
- [ ] 데이터 프리뷰 컴포넌트
- [ ] 인터랙티브 필드 선택
- [ ] 데이터 변환 규칙 UI

#### 4.2 테스트 모드 구현 (Day 3)
- [ ] 시뮬레이션 실행 엔진
- [ ] 단계별 실행 디버거
- [ ] 결과 프리뷰
- [ ] 로그 뷰어

#### 4.3 최종 통합 및 최적화 (Day 4-5)
- [ ] 전체 시스템 통합 테스트
- [ ] 성능 최적화
- [ ] 에러 처리 강화
- [ ] 문서화

## 3. 기술 스택

### 백엔드
- **Framework**: FastAPI (비동기 지원)
- **Language**: Python 3.10+
- **Libraries**:
  - `ast` - AST 파싱 및 코드 생성
  - `pydantic` - 데이터 검증
  - `aiofiles` - 비동기 파일 처리
  - 기존 `mcp_service_decorator`, `mcp_service_scanner`

### 프론트엔드
- **Framework**: React 18
- **State Management**: Redux Toolkit
- **UI Components**:
  - React Flow - 플로우 차트
  - React DnD - 드래그 앤 드롭
  - Ant Design / MUI - UI 컴포넌트
- **Build Tool**: Vite

## 4. 주요 마일스톤

| 마일스톤 | 목표 날짜 | 성공 기준 |
|---------|----------|----------|
| M1: 백엔드 기초 | Week 1 완료 | 서비스 스캔 및 기본 API 동작 |
| M2: 코드 생성 | Week 2 완료 | 체인 함수 자동 생성 및 삽입 |
| M3: UI 구현 | Week 3 완료 | 플로우 에디터 및 매핑 UI 완성 |
| M4: 전체 통합 | Week 4 완료 | 엔드투엔드 체인 생성 및 실행 |

## 5. 리스크 관리

### 기술적 리스크
1. **AST 코드 수정 복잡도**
   - 완화: 충분한 테스트 및 백업 메커니즘

2. **Redux 상태 관리 복잡도**
   - 완화: 명확한 상태 구조 설계 및 Redux Toolkit 활용

3. **실시간 데이터 매핑 성능**
   - 완화: 디바운싱, 메모이제이션 활용

### 일정 리스크
1. **React Flow 커스터마이징**
   - 버퍼: 3일 추가 확보

2. **중간 인터페이스 복잡도**
   - 완화: MVP 먼저 구현 후 점진적 개선

## 6. 개발 순서 우선순위

### 필수 기능 (P0)
1. 서비스 함수 스캔 및 메타데이터 수집
2. 기본 체인 생성 (2개 함수 연결)
3. 코드 생성 및 파일 수정
4. 기본 매핑 (직접 매핑)

### 중요 기능 (P1)
1. 플로우 에디터 UI
2. 파라미터 매핑 UI
3. 중복 파라미터 처리
4. 테스트 모드

### 선택 기능 (P2)
1. 고급 매핑 (변환 규칙)
2. 템플릿 저장/불러오기
3. 다중 체인 (3개 이상 함수)
4. 병렬 실행

## 7. 팀 구성 제안
- **백엔드 개발자**: 1명 (코드 생성, API)
- **프론트엔드 개발자**: 1명 (React, UI)
- **풀스택 개발자**: 1명 (통합, 테스트)

## 8. 다음 단계
1. 프로젝트 디렉토리 생성
2. 개발 환경 설정
3. 기본 API 서버 구축
4. 첫 번째 프로토타입 개발