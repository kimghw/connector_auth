@startuml RAG_System_Class_Diagram

' RAG System Class Diagram - Single Responsibility Principle
' 각 클래스는 하나의 책임만 가짐

package "Data Models" {
    class Document {
        - id: String
        - filename: String
        - file_path: String
        - file_size: Integer
        - upload_time: DateTime
        - status: DocumentStatus
        - chunk_count: Integer
        - error_message: String
        --
        + to_dict(): Dictionary
        .. Single Responsibility ..
        문서 메타데이터 관리
    }

    class Chunk {
        - id: String
        - document_id: String
        - chunk_index: Integer
        - content: String
        - token_count: Integer
        - char_start: Integer
        - char_end: Integer
        - embedding_id: String
        --
        + to_dict(): Dictionary
        .. Single Responsibility ..
        텍스트 청크 단위 관리
    }

    class SearchResult {
        - chunk_id: String
        - document_id: String
        - document_name: String
        - content: String
        - similarity_score: Float
        - chunk_index: Integer
        --
        + to_dict(): Dictionary
        .. Single Responsibility ..
        검색 결과 표현
    }

    class ProcessStatus {
        - doc_id: String
        - status: DocumentStatus
        - current_step: ProcessingStep
        - progress: Integer
        - error_message: String
        - started_at: DateTime
        - updated_at: DateTime
        --
        + to_dict(): Dictionary
        .. Single Responsibility ..
        처리 상태 추적
    }
}

package "Enumerations" {
    enum DocumentStatus {
        PENDING
        PROCESSING
        COMPLETED
        ERROR
        DELETED
    }

    enum ProcessingStep {
        UPLOAD
        EXTRACTION
        CHUNKING
        EMBEDDING
        INDEXING
        COMPLETED
    }
}

package "Core Components (Single Responsibility)" {
    interface IDocumentManager {
        + upload(file_path: String): String
        + list_all(status: DocumentStatus): List<Document>
        + get_by_id(doc_id: String): Document
        + delete(doc_id: String): Boolean
        .. Responsibility ..
        문서 생명주기 관리
    }

    interface ITextProcessor {
        + extract_text(file_path: String): String
        + clean_text(text: String): String
        + normalize_text(text: String): String
        .. Responsibility ..
        텍스트 추출 및 정제
    }

    interface IChunker {
        + create_chunks(text: String, max_tokens: Integer): List<Chunk>
        + count_tokens(text: String): Integer
        .. Responsibility ..
        텍스트를 청크로 분할
    }

    interface IEmbeddingGenerator {
        + generate_embedding(text: String): Vector
        + generate_embeddings_batch(texts: List<String>): List<Vector>
        + dimension: Integer
        .. Responsibility ..
        텍스트를 벡터로 변환
    }

    interface ISearchEngine {
        + search(query: String, top_k: Integer): List<SearchResult>
        + search_with_filter(query: String, filters: Map): List<SearchResult>
        .. Responsibility ..
        의미 기반 검색 수행
    }

    interface IVectorStore {
        + add_vector(chunk_id: String, vector: Vector): Boolean
        + search_vectors(query_vector: Vector, top_k: Integer): List<Tuple>
        + delete_vector(chunk_id: String): Boolean
        + get_vector(chunk_id: String): Vector
        + rebuild_index(): Boolean
        .. Responsibility ..
        벡터 저장 및 검색
    }
}

package "Facade Pattern" {
    class RAGService <<Facade>> {
        - document_manager: IDocumentManager
        - text_processor: ITextProcessor
        - chunker: IChunker
        - embedding_generator: IEmbeddingGenerator
        - search_engine: ISearchEngine
        - vector_store: IVectorStore
        --
        + upload_document(file_path: String): String
        + process_document(doc_id: String): ProcessStatus
        + search(query: String): List<SearchResult>
        .. Single Responsibility ..
        복잡한 하위 시스템의 단순한 인터페이스 제공
    }
}

' Relationships
Document "1" --> "*" Chunk : contains
Document ..> DocumentStatus : uses
ProcessStatus ..> DocumentStatus : uses
ProcessStatus ..> ProcessingStep : uses

RAGService --> IDocumentManager : uses
RAGService --> ITextProcessor : uses
RAGService --> IChunker : uses
RAGService --> IEmbeddingGenerator : uses
RAGService --> ISearchEngine : uses
RAGService --> IVectorStore : uses

IDocumentManager ..> Document : manages
IChunker ..> Chunk : creates
ISearchEngine ..> SearchResult : returns
ISearchEngine --> IVectorStore : queries
IEmbeddingGenerator --> IVectorStore : feeds

' Notes
note right of RAGService
  **Facade Pattern**
  사용자는 RAGService만 알면 됨
  내부 복잡도는 숨겨짐
end note

note bottom of IDocumentManager
  **Single Responsibility Principle**
  각 인터페이스는 하나의 역할만 담당
  - DocumentManager: 문서 관리
  - TextProcessor: 텍스트 처리
  - Chunker: 청킹
  - EmbeddingGenerator: 임베딩
  - SearchEngine: 검색
  - VectorStore: 벡터 저장
end note

@enduml